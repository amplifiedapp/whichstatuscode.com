#! /bin/sh

git_status="$(git status 2> /dev/null)"
git_branch=$(git branch 2>/dev/null| sed -n '/^\*/s/^\* //p')

if [[ ! ${git_status} =~ "working directory clean" ]]; then
  echo "You still have changes in your current branch. Commit everything before publishing."
  exit 1
fi

git fetch 2> /dev/null
git co gh-pages
mv build/* .
git add -A
git commit -m "Site update"
git push origin gh-pages
git co ${git_branch}

echo "Done publishing!"
